<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guia Interativo de Dockerfile</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Calm Neutrals -->
    <!-- Application Structure Plan: A aplica√ß√£o foi estruturada como uma SPA (Single Page Application) tem√°tica e progressiva. A navega√ß√£o fixa no topo permite acesso r√°pido a qualquer se√ß√£o, funcionando tanto como um tutorial linear quanto como uma refer√™ncia r√°pida. A estrutura √© dividida em: 1. Introdu√ß√£o (O que √©?), 2. Anatomia Interativa (o n√∫cleo, para aprendizado ativo), 3. Comandos Detalhados (refer√™ncia), 4. Builds em M√∫ltiplos Est√°gios (conceito avan√ßado comparativo) e 5. Melhores Pr√°ticas (dicas r√°pidas). Esta arquitetura foi escolhida para decompor um t√≥pico t√©cnico complexo em partes gerenci√°veis e interativas, facilitando a absor√ß√£o do conte√∫do e o engajamento do usu√°rio. -->
    <!-- Visualization & Content Choices: 1. Anatomia do Dockerfile: Report Info -> Comandos do Dockerfile. Goal -> Informar/Organizar. Viz -> Bloco de c√≥digo interativo. Interaction -> Clicar nos comandos para exibir detalhes. Justification -> Fomenta o aprendizado ativo e focado, evitando sobrecarga de informa√ß√£o. Library/Method -> Vanilla JS. 2. Builds em M√∫ltiplos Est√°gios: Report Info -> Compara√ß√£o de tamanho de imagem. Goal -> Comparar. Viz -> Gr√°fico de barras horizontais (Chart.js) e blocos de c√≥digo altern√°veis. Interaction -> Bot√£o de toggle para alternar entre as vis√µes e atualizar o gr√°fico. Justification -> A compara√ß√£o visual direta √© a forma mais eficaz de demonstrar o benef√≠cio da t√©cnica. Library/Method -> Chart.js + Vanilla JS. 3. Melhores Pr√°ticas: Report Info -> Dicas e regras. Goal -> Informar. Viz -> Layout de cart√µes. Interaction -> Nenhuma, foco na clareza e legibilidade. Justification -> Formato ideal para listas de recomenda√ß√µes. Library/Method -> HTML/Tailwind. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
            color: #212529;
        }
        code, .code-font {
            font-family: 'Fira Code', monospace;
        }
        .command-highlight {
            cursor: pointer;
            font-weight: 500;
            color: #007bff;
            text-decoration: underline;
            text-decoration-style: dotted;
            transition: background-color 0.2s;
        }
        .command-highlight.active {
            background-color: #cfe2ff;
            border-radius: 4px;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 200px;
            max-height: 250px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 250px;
            }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <header class="bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-50">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <span class="font-bold text-xl text-blue-600">üê≥ Guia Dockerfile</span>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="#intro" class="text-slate-600 hover:bg-blue-500 hover:text-white px-3 py-2 rounded-md text-sm font-medium">O Que √©?</a>
                        <a href="#anatomy" class="text-slate-600 hover:bg-blue-500 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Anatomia</a>
                        <a href="#multistage" class="text-slate-600 hover:bg-blue-500 hover:text-white px-3 py-2 rounded-md text-sm font-medium">M√∫ltiplos Est√°gios</a>
                        <a href="#best-practices" class="text-slate-600 hover:bg-blue-500 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Melhores Pr√°ticas</a>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">

        <section id="intro" class="mb-16 text-center">
            <h1 class="text-4xl md:text-5xl font-bold text-slate-900 mb-4">Desmistificando o Dockerfile</h1>
            <p class="max-w-3xl mx-auto text-lg text-slate-600">
                Um Dockerfile √© um roteiro, um arquivo de texto simples que cont√©m todas as instru√ß√µes necess√°rias para o Docker montar uma imagem. Pense nele como uma receita de bolo: cada linha √© um passo para criar o ambiente perfeito e padronizado para sua aplica√ß√£o rodar em qualquer lugar.
            </p>
        </section>

        <section id="anatomy" class="mb-16">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-slate-900">Anatomia de um Dockerfile</h2>
                <p class="mt-2 text-md text-slate-600 max-w-2xl mx-auto">
                    Todo Dockerfile √© composto por uma s√©rie de comandos. Clique em cada instru√ß√£o no exemplo abaixo para ver uma explica√ß√£o detalhada de sua fun√ß√£o, sintaxe e como ela contribui para a constru√ß√£o da imagem final.
                </p>
            </div>
            <div class="grid md:grid-cols-2 gap-8 items-start">
                <div class="bg-gray-800 rounded-lg shadow-lg p-6 text-sm text-gray-200 overflow-x-auto">
                    <pre><code class="language-dockerfile"><span class="text-gray-500"># Est√°gio 1: Build</span>
<span class="command-highlight active" data-command="FROM">FROM</span> node:18-alpine AS builder

<span class="command-highlight" data-command="WORKDIR">WORKDIR</span> /app

<span class="command-highlight" data-command="COPY">COPY</span> package*.json ./

<span class="command-highlight" data-command="RUN">RUN</span> npm install

<span class="command-highlight" data-command="COPY">COPY</span> . .

<span class="command-highlight" data-command="RUN">RUN</span> npm run build

<span class="text-gray-500"># Est√°gio 2: Produ√ß√£o</span>
<span class="command-highlight" data-command="FROM">FROM</span> nginx:stable-alpine

<span class="command-highlight" data-command="COPY">COPY</span> --from=builder /app/build /usr/share/nginx/html

<span class="command-highlight" data-command="EXPOSE">EXPOSE</span> 80

<span class="command-highlight" data-command="CMD">CMD</span> ["nginx", "-g", "daemon off;"]
</code></pre>
                </div>
                <div id="command-details" class="bg-white p-6 rounded-lg shadow-lg border border-slate-200 min-h-[300px]">
                </div>
            </div>
        </section>
        
        <section id="multistage" class="mb-16">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-slate-900">Constru√ß√£o em M√∫ltiplos Est√°gios</h2>
                <p class="mt-2 text-md text-slate-600 max-w-2xl mx-auto">
                    Uma das t√©cnicas mais importantes para otimizar imagens √© o "multi-stage build". O objetivo √© usar um est√°gio para compilar ou construir a aplica√ß√£o (com todas as suas depend√™ncias de desenvolvimento) e um est√°gio final, muito menor, apenas com os arquivos necess√°rios para rodar, resultando em imagens mais leves e seguras.
                </p>
                 <button id="toggle-build-type" class="mt-4 bg-blue-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors">
                    Ver Exemplo Simples (Sem Otimiza√ß√£o)
                </button>
            </div>
           
            <div class="grid md:grid-cols-2 gap-8 items-center">
                <div id="code-multistage" class="bg-gray-800 rounded-lg shadow-lg p-4 text-sm text-gray-200 overflow-x-auto">
                    <h3 class="font-bold text-lg mb-2 text-white text-center">‚úÖ Otimizado (Multi-Stage)</h3>
                    <pre><code class="language-dockerfile"><span class="text-gray-500"># Build stage</span>
FROM node:18-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build

<span class="text-gray-500"># Production stage</span>
FROM nginx:stable-alpine
COPY --from=builder /app/build /usr/share/nginx/html
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
</code></pre>
                </div>
                <div id="code-singlestage" class="bg-gray-800 rounded-lg shadow-lg p-4 text-sm text-gray-200 overflow-x-auto hidden">
                     <h3 class="font-bold text-lg mb-2 text-white text-center">‚ùå N√£o Otimizado (Single-Stage)</h3>
                    <pre><code class="language-dockerfile">FROM node:18-alpine
WORKDIR /app
COPY . .
RUN npm install
RUN npm run build

# Problema: A imagem final cont√©m
# todo o c√≥digo fonte e as 
# node_modules, sendo muito grande.

EXPOSE 3000
CMD ["npm", "start"]
</code></pre>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-lg border border-slate-200">
                    <h3 class="text-xl font-bold text-center mb-4">Impacto no Tamanho da Imagem</h3>
                    <div class="chart-container">
                        <canvas id="imageSizeChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <section id="best-practices">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-slate-900">Melhores Pr√°ticas</h2>
                <p class="mt-2 text-md text-slate-600 max-w-2xl mx-auto">
                    Escrever um bom Dockerfile √© uma arte. Seguir estas pr√°ticas resultar√° em builds mais r√°pidos, imagens menores e mais seguras, facilitando a manuten√ß√£o e o deploy de suas aplica√ß√µes.
                </p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="bg-white p-6 rounded-lg shadow-md border border-slate-200 hover:shadow-xl transition-shadow">
                    <h3 class="font-bold text-lg mb-2 text-blue-600">Use .dockerignore</h3>
                    <p class="text-slate-600">Exclua arquivos e diret√≥rios desnecess√°rios (como `node_modules`, logs, `.git`) do contexto do build para acelerar o processo e evitar que informa√ß√µes sens√≠veis vazem para a imagem.</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md border border-slate-200 hover:shadow-xl transition-shadow">
                    <h3 class="font-bold text-lg mb-2 text-blue-600">Minimize o n√∫mero de camadas</h3>
                    <p class="text-slate-600">Cada instru√ß√£o `RUN`, `COPY` e `ADD` cria uma nova camada. Combine comandos `RUN` com `&&` para reduzir o n√∫mero de camadas e, consequentemente, o tamanho da imagem.</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md border border-slate-200 hover:shadow-xl transition-shadow">
                    <h3 class="font-bold text-lg mb-2 text-blue-600">Ordene os comandos estrategicamente</h3>
                    <p class="text-slate-600">Coloque as instru√ß√µes que mudam com menos frequ√™ncia (ex: instalar depend√™ncias) antes das que mudam sempre (ex: copiar o c√≥digo-fonte) para aproveitar o cache de camadas do Docker.</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md border border-slate-200 hover:shadow-xl transition-shadow">
                    <h3 class="font-bold text-lg mb-2 text-blue-600">Use imagens base espec√≠ficas</h3>
                    <p class="text-slate-600">Evite usar a tag `:latest`. Especifique vers√µes exatas (ex: `node:18.12-alpine`) para garantir builds consistentes e evitar que atualiza√ß√µes inesperadas quebrem sua aplica√ß√£o.</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md border border-slate-200 hover:shadow-xl transition-shadow">
                    <h3 class="font-bold text-lg mb-2 text-blue-600">Prefira `COPY` em vez de `ADD`</h3>
                    <p class="text-slate-600">`ADD` tem funcionalidades "m√°gicas", como descompactar arquivos e baixar de URLs, o que pode ser um risco de seguran√ßa. Use `COPY` para maior clareza e previsibilidade.</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md border border-slate-200 hover:shadow-xl transition-shadow">
                    <h3 class="font-bold text-lg mb-2 text-blue-600">Execute como usu√°rio n√£o-root</h3>
                    <p class="text-slate-600">Por seguran√ßa, crie um usu√°rio espec√≠fico com a instru√ß√£o `USER` e execute sua aplica√ß√£o com ele, seguindo o princ√≠pio do menor privil√©gio para reduzir a superf√≠cie de ataque.</p>
                </div>
            </div>
        </section>

    </main>
    
    <footer class="bg-slate-800 text-white mt-16">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4 text-center">
            <p>&copy; 2025 Guia Interativo de Dockerfile. Criado para facilitar o aprendizado.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            const commandDetailsData = {
                FROM: {
                    title: 'FROM',
                    description: 'Define a imagem base para as instru√ß√µes subsequentes. Todo Dockerfile v√°lido deve come√ßar com uma instru√ß√£o `FROM`.',
                    syntax: '<code>FROM &lt;imagem&gt;[:&lt;tag&gt;] [AS &lt;nome&gt;]</code>'
                },
                RUN: {
                    title: 'RUN',
                    description: 'Executa qualquer comando em uma nova camada sobre a imagem atual e commita o resultado. √â frequentemente usado para instalar pacotes de software.',
                    syntax: '<code>RUN &lt;comando&gt;</code> (shell form) ou <code>RUN ["execut√°vel", "param1", "param2"]</code> (exec form)'
                },
                CMD: {
                    title: 'CMD',
                    description: 'Fornece um comando padr√£o para a execu√ß√£o de um cont√™iner. S√≥ pode haver uma instru√ß√£o `CMD` em um Dockerfile. Se houver mais de uma, apenas a √∫ltima ter√° efeito.',
                    syntax: '<code>CMD ["execut√°vel","param1","param2"]</code> (exec form, preferencial)'
                },
                WORKDIR: {
                    title: 'WORKDIR',
                    description: 'Define o diret√≥rio de trabalho para quaisquer instru√ß√µes `RUN`, `CMD`, `ENTRYPOINT`, `COPY` e `ADD` que o seguem no Dockerfile.',
                    syntax: '<code>WORKDIR /caminho/para/diretorio</code>'
                },
                COPY: {
                    title: 'COPY',
                    description: 'Copia novos arquivos ou diret√≥rios do contexto do build e os adiciona ao sistema de arquivos do cont√™iner no caminho especificado.',
                    syntax: '<code>COPY [--from=&lt;nome_ou_indice_do_estagio&gt;] &lt;origem&gt; &lt;destino&gt;</code>'
                },
                EXPOSE: {
                    title: 'EXPOSE',
                    description: 'Informa ao Docker que o cont√™iner escuta em portas de rede espec√≠ficas em tempo de execu√ß√£o. N√£o publica a porta, apenas funciona como um tipo de documenta√ß√£o entre a pessoa que constr√≥i a imagem e a que a executa.',
                    syntax: '<code>EXPOSE &lt;porta&gt;[/&lt;protocolo&gt;]</code>'
                }
            };

            const detailsContainer = document.getElementById('command-details');
            const commandHighlights = document.querySelectorAll('.command-highlight');

            function updateDetails(commandKey) {
                const details = commandDetailsData[commandKey];
                if (details) {
                    detailsContainer.innerHTML = `
                        <h3 class="text-2xl font-bold text-blue-600 mb-2 code-font">${details.title}</h3>
                        <p class="text-slate-700 mb-4">${details.description}</p>
                        <div class="bg-slate-100 p-3 rounded-md">
                            <h4 class="font-semibold text-slate-800 mb-1">Sintaxe:</h4>
                            <p class="text-sm text-slate-600 code-font">${details.syntax}</p>
                        </div>
                    `;
                }
            }

            commandHighlights.forEach(el => {
                el.addEventListener('click', () => {
                    commandHighlights.forEach(i => i.classList.remove('active'));
                    el.classList.add('active');
                    const commandKey = el.getAttribute('data-command');
                    updateDetails(commandKey);
                });
            });

            updateDetails('FROM');

            const toggleButton = document.getElementById('toggle-build-type');
            const codeMultistage = document.getElementById('code-multistage');
            const codeSinglestage = document.getElementById('code-singlestage');
            let isMultiStage = true;

            const ctx = document.getElementById('imageSizeChart').getContext('2d');
            const imageSizeChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Tamanho da Imagem Final'],
                    datasets: [{
                        label: 'N√£o Otimizado (MB)',
                        data: [750],
                        backgroundColor: 'rgba(239, 68, 68, 0.6)',
                        borderColor: 'rgba(239, 68, 68, 1)',
                        borderWidth: 1
                    }, {
                        label: 'Otimizado (MB)',
                        data: [22],
                        backgroundColor: 'rgba(59, 130, 246, 0.6)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: false,
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.x !== null) {
                                        label += context.parsed.x + ' MB';
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Tamanho (MB)'
                            }
                        }
                    }
                }
            });


            toggleButton.addEventListener('click', () => {
                isMultiStage = !isMultiStage;
                if(isMultiStage) {
                    toggleButton.textContent = 'Ver Exemplo Simples (Sem Otimiza√ß√£o)';
                    codeMultistage.classList.remove('hidden');
                    codeSinglestage.classList.add('hidden');
                } else {
                    toggleButton.textContent = 'Ver Exemplo Otimizado (Multi-Stage)';
                    codeMultistage.classList.add('hidden');
                    codeSinglestage.classList.remove('hidden');
                }
            });
            
             document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    document.querySelector(this.getAttribute('href')).scrollIntoView({
                        behavior: 'smooth'
                    });
                });
            });

        });
    </script>
</body>
</html>